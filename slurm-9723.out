WARNING:__main__:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
| distributed init (rank 2, world 4): env://
| distributed init (rank 0, world 4): env://
| distributed init (rank 1, world 4): env://
| distributed init (rank 3, world 4): env://
2023-04-25 19:06:57,447 [INFO] 
=====  Running Parameters    =====
2023-04-25 19:06:57,447 [INFO] {
    "amp": true,
    "batch_size_eval": 64,
    "batch_size_train": 256,
    "device": "cuda",
    "dist_backend": "nccl",
    "dist_url": "env://",
    "distributed": true,
    "evaluate": false,
    "gpu": 0,
    "init_lr": 0.0001,
    "lr_sched": "linear_warmup_cosine_lr",
    "max_epoch": 10,
    "min_lr": 1e-05,
    "num_workers": 4,
    "output_dir": "/home/bingxing2/home/scx6150/output/BLIP2/Pretrain_stage2",
    "rank": 0,
    "resume_ckpt_path": null,
    "seed": 42,
    "task": "image_text_pretrain",
    "train_splits": [
        "train"
    ],
    "warmup_lr": 1e-06,
    "warmup_steps": 2000,
    "weight_decay": 0.05,
    "world_size": 4
}
2023-04-25 19:06:57,447 [INFO] 
======  Dataset Attributes  ======
2023-04-25 19:06:57,447 [INFO] 
======== coco_caption_flan =======
2023-04-25 19:06:57,448 [INFO] {
    "build_info": {
        "annotations": {
            "test": {
                "md5": "3ff34b0ef2db02d01c37399f6a2a6cd1",
                "storage": "/home/bingxing2/home/scx6150/datasets/coco/annotations/coco_karpathy_test.json",
                "url": "https://storage.googleapis.com/sfr-vision-language-research/datasets/coco_karpathy_test.json"
            },
            "train": {
                "md5": "aa31ac474cf6250ebb81d18348a07ed8",
                "storage": "/home/bingxing2/home/scx6150/datasets/coco/annotations/coco_karpathy_train.json",
                "url": "https://storage.googleapis.com/sfr-vision-language-research/datasets/coco_karpathy_train.json"
            },
            "val": {
                "md5": "b273847456ef5580e33713b1f7de52a0",
                "storage": "/home/bingxing2/home/scx6150/datasets/coco/annotations/coco_karpathy_val.json",
                "url": "https://storage.googleapis.com/sfr-vision-language-research/datasets/coco_karpathy_val.json"
            }
        },
        "images": {
            "storage": "/home/bingxing2/home/scx6150/datasets/coco/images/"
        }
    },
    "data_type": "images",
    "dataset_card": "dataset_card/coco_caption.md",
    "text_processor": {
        "train": {
            "name": "blip_caption"
        }
    },
    "vis_processor": {
        "train": {
            "image_size": 224,
            "name": "blip2_image_train"
        }
    }
}
2023-04-25 19:06:57,448 [INFO] 
======== vg_caption_flan =======
2023-04-25 19:06:57,448 [INFO] {
    "build_info": {
        "annotations": {
            "train": {
                "storage": "/home/bingxing2/home/scx6150/datasets/VG/annotations/vg_caption.json",
                "url": "https://storage.googleapis.com/sfr-vision-language-research/LAVIS/datasets/visual_genome/vg_caption.json"
            }
        },
        "images": {
            "storage": "/home/bingxing2/home/scx6150/datasets/VG/images/"
        }
    },
    "data_type": "images",
    "text_processor": {
        "train": {
            "name": "blip_caption"
        }
    },
    "vis_processor": {
        "train": {
            "image_size": 224,
            "name": "blip_image_train"
        }
    }
}
2023-04-25 19:06:57,448 [INFO] 
======  Model Attributes  ======
2023-04-25 19:06:57,449 [INFO] {
    "arch": "blip2_t5",
    "drop_path_rate": 0,
    "finetuned": "",
    "freeze_vit": true,
    "image_size": 224,
    "load_finetuned": false,
    "load_pretrained": false,
    "model_type": "pretrain_flant5b",
    "num_query_token": 32,
    "pretrained": "https://storage.googleapis.com/sfr-vision-language-research/LAVIS/models/BLIP2/blip2_pretrained.pth",
    "prompt": "",
    "t5_model": "google/flan-t5-base",
    "use_grad_checkpoint": false,
    "vit_precision": "fp16"
}
Using downloaded and verified file: /home/bingxing2/home/scx6150/datasets/coco/annotations/coco_karpathy_train.json
Using downloaded and verified file: /home/bingxing2/home/scx6150/datasets/coco/annotations/coco_karpathy_val.json
Using downloaded and verified file: /home/bingxing2/home/scx6150/datasets/coco/annotations/coco_karpathy_test.json
2023-04-25 19:06:57,455 [INFO] Building datasets...
Using downloaded and verified file: /home/bingxing2/home/scx6150/datasets/VG/annotations/vg_caption.json
2023-04-25 19:06:58,336 [INFO] Building datasets...
2023-04-25 19:08:41,359 [INFO] freeze vision encoder
train from scratch
2023-04-25 19:08:58,979 [INFO] Start training
2023-04-25 19:09:00,260 [INFO] dataset_ratios not specified, datasets will be concatenated (map-style datasets) or chained (webdataset.DataPipeline).
2023-04-25 19:09:00,260 [INFO] Loaded 1388521 records for train split from the dataset.
2023-04-25 19:09:00,260 [INFO] Loaded 5000 records for val split from the dataset.
2023-04-25 19:09:00,260 [INFO] Loaded 5000 records for test split from the dataset.
2023-04-25 19:09:00,276 [INFO] number of trainable parameters: 105755648
2023-04-25 19:09:00,277 [INFO] Start training epoch 0, 1355 iters per inner epoch.
/home/bingxing2/home/scx6150/code/LAVIS/lavis/processors/randaugment.py:40: RuntimeWarning: overflow encountered in scalar negative
  offset = -low * scale
/home/bingxing2/home/scx6150/code/LAVIS/lavis/processors/randaugment.py:40: RuntimeWarning: overflow encountered in scalar negative
  offset = -low * scale
/home/bingxing2/home/scx6150/code/LAVIS/lavis/processors/randaugment.py:40: RuntimeWarning: overflow encountered in scalar negative
  offset = -low * scale
/home/bingxing2/home/scx6150/code/LAVIS/lavis/processors/randaugment.py:40: RuntimeWarning: overflow encountered in scalar negative
  offset = -low * scale
/home/bingxing2/home/scx6150/code/LAVIS/lavis/processors/randaugment.py:40: RuntimeWarning: overflow encountered in scalar negative
  offset = -low * scale
/home/bingxing2/home/scx6150/code/LAVIS/lavis/processors/randaugment.py:40: RuntimeWarning: overflow encountered in scalar negative
  offset = -low * scale
/home/bingxing2/home/scx6150/code/LAVIS/lavis/processors/randaugment.py:40: RuntimeWarning: overflow encountered in scalar negative
  offset = -low * scale
/home/bingxing2/home/scx6150/code/LAVIS/lavis/processors/randaugment.py:40: RuntimeWarning: overflow encountered in scalar negative
  offset = -low * scale
/home/bingxing2/home/scx6150/code/LAVIS/lavis/processors/randaugment.py:40: RuntimeWarning: overflow encountered in scalar negative
  offset = -low * scale
/home/bingxing2/home/scx6150/code/LAVIS/lavis/processors/randaugment.py:40: RuntimeWarning: overflow encountered in scalar negative
  offset = -low * scale
/home/bingxing2/home/scx6150/code/LAVIS/lavis/processors/randaugment.py:40: RuntimeWarning: overflow encountered in scalar negative
  offset = -low * scale
/home/bingxing2/home/scx6150/code/LAVIS/lavis/processors/randaugment.py:40: RuntimeWarning: overflow encountered in scalar negative
  offset = -low * scale
/home/bingxing2/home/scx6150/code/LAVIS/lavis/processors/randaugment.py:40: RuntimeWarning: overflow encountered in scalar negative
  offset = -low * scale
/home/bingxing2/home/scx6150/code/LAVIS/lavis/processors/randaugment.py:40: RuntimeWarning: overflow encountered in scalar negative
  offset = -low * scale
/home/bingxing2/home/scx6150/code/LAVIS/lavis/processors/randaugment.py:40: RuntimeWarning: overflow encountered in scalar negative
  offset = -low * scale
/home/bingxing2/home/scx6150/code/LAVIS/lavis/processors/randaugment.py:40: RuntimeWarning: overflow encountered in scalar negative
  offset = -low * scale
Train: data epoch: [0]  [   0/1355]  eta: 3:20:16  lr: 0.000001  loss: 4.3722  time: 8.8681  data: 0.0000  max mem: 23272
2023-04-25 19:09:09,158 [INFO] Reducer buckets have been rebuilt in this iteration.
Train: data epoch: [0]  [  50/1355]  eta: 0:51:07  lr: 0.000003  loss: 3.6867  time: 2.2131  data: 0.0000  max mem: 27948
Train: data epoch: [0]  [ 100/1355]  eta: 0:47:49  lr: 0.000006  loss: 3.5220  time: 2.2189  data: 0.0000  max mem: 27948
Train: data epoch: [0]  [ 150/1355]  eta: 0:45:27  lr: 0.000008  loss: 3.3267  time: 2.2249  data: 0.0000  max mem: 27948
Train: data epoch: [0]  [ 200/1355]  eta: 0:43:22  lr: 0.000011  loss: 3.2582  time: 2.2229  data: 0.0000  max mem: 28580
Train: data epoch: [0]  [ 250/1355]  eta: 0:41:20  lr: 0.000013  loss: 3.3797  time: 2.2161  data: 0.0000  max mem: 28580
Train: data epoch: [0]  [ 300/1355]  eta: 0:39:24  lr: 0.000016  loss: 3.3177  time: 2.2116  data: 0.0000  max mem: 28580
Train: data epoch: [0]  [ 350/1355]  eta: 0:37:28  lr: 0.000018  loss: 3.2934  time: 2.2121  data: 0.0000  max mem: 28580
